@model AutomobileProject.ViewModels.Offer.AddCarViewModel
@using AutomobileProject.ViewModels.Offer.Enums
@{
    ViewData["Title"] = "Add";
}


<div class="container">
    <main role="main" class="pb-3">
        <form col-md-4 class="form-horizontal" asp-controller="Offer" asp-action="AddCar" method="post" enctype="multipart/form-data" id="form">
            <fieldset>

                <!-- Form Name -->
                <legend>Add a Car offer</legend>

                <div asp-validation-summary="All" class="text-danger form-group"></div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="Title"></label>
                    <input style="color:black" asp-for="Title" class="form-control" />
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>

                <!-- Select Make-->
                <!-- TODO: Fix Bug after page reload to be able to match make and model again-->
                <div class="form-group">
                    <label asp-for="Make"></label>
                    <select class="form-control" asp-for="Make" style="font-family: Arial; color:black; position:relative; padding: 8px 16px;  border: 1px solid groove;  cursor: pointer;" name="Make" id="makes">
                        @foreach (var make in Model.MakeModel.OrderBy(x => x.Make).Select(x => x.Make).Distinct())
                        {
                            <option class="form-control" style="color: black" value="@make">@make</option>
                        }
                    </select>

                    <label asp-for="Model"></label>
                    <select class="form-control" style="font-family: Arial; color:black; position:relative; padding: 8px 16px;  border: 1px solid groove; cursor: pointer;" id="models">
                        @foreach (var car in Model.MakeModel.OrderBy(x => x.Model))
                        {
                            <option class="form-control" style="color: black" value="@car.Make">@car.Model</option>
                        }
                    </select>

                    <input asp-for="Model" type="hidden" id="Model" name="Model" value="">

                    <!--Script to set the Models to match the chosen Make-->
                    <script>
                        fetch('/Offer/AddCar')
                            .then(response => {
                                var $make = $('#makes'),
                                    $model = $('#models'),
                                    $options = $model.find('option'),
                                    $hiddenModel = $('#Model');

                                $make.on('change', function () {
                                    $model.html($options.filter('[value="' + this.value + '"]'));
                                    $model.trigger('change');
                                }).trigger('change');
                            });
                    </script>
                </div>


                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="Year"></label>
                    <input style="color:black" asp-for="Year" class="form-control" />
                    <span asp-validation-for="Year" class="text-danger"></span>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="Price"></label>
                    <input style="color:black" asp-for="Price" class="form-control" />
                    <span asp-validation-for="Price" class="text-danger"></span>
                </div>

                <!-- Select condition-->
                <div class="form-group">
                    <label asp-for="Condition"></label>
                    <select class="form-control" asp-for="Condition" asp-items="@Html.GetEnumSelectList<Condition>()" style="color:black; font-family: Arial; position:relative; padding: 8px 16px;  border: 1px solid groove; cursor: pointer;" id="conditions">
                    </select>
                    <span asp-validation-for="Condition" class="text-danger"></span>
                </div>

                <!-- Select condition-->
                <div class="form-group">
                    <label asp-for="FuelType"></label>
                    <select class="form-control" asp-for="FuelType" asp-items="@Html.GetEnumSelectList<FuelType>()" style="color:black; font-family: Arial; position:relative; padding: 8px 16px;  border: 1px solid groove; cursor: pointer;">
                    </select>
                    <span asp-validation-for="FuelType" class="text-danger"></span>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="HorsePower"></label>
                    <input style="color:black" asp-for="HorsePower" class="form-control" />
                    <span asp-validation-for="HorsePower" class="text-danger"></span>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="Kilometers"></label>
                    <input style="color:black" asp-for="Kilometers" class="form-control" />
                    <span asp-validation-for="Kilometers" class="text-danger"></span>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="Description"></label>
                    <textarea style="color:black" asp-for="Description" class="form-control"></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label asp-for="ContactNumber"></label>
                    <input style="color:black" asp-for="ContactNumber" class="form-control" />
                    <span asp-validation-for="ContactNumber" class="text-danger"></span>
                </div>

                <!-- Image upload-->
                <div class="form-group">
                    <input class="control-label btn-primary" style="padding: 1em; position:relative" type="file" asp-for="ImageFile">
                </div>

                <!-- Button -->
                <div class="form-group">
                    <button style="width:150px; float:right" id="singlebutton" name="singlebutton" class="btn btn-primary">Submit</button>
                </div>

                <!-- Script to set the value of Model to the correct text value of the select option of Models select -->
                <script>
                    fetch('/Offer/AddCar')
                        .then(response => {
                            var $singlebutton = $('#singlebutton');
                            var $selectedModel = document.getElementById('models');

                            $singlebutton.on('click', function () {
                                document.getElementById("Model").value = $selectedModel.options[$selectedModel.selectedIndex].text;
                                console.log(document.getElementById("Model").textContent);
                            });
                        });
                </script>

            </fieldset>
        </form>
    </main>
</div>
